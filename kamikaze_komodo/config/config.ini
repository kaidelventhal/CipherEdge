# kamikaze_komodo/config/config.ini

[General]
LogLevel = INFO
LogFilePath = logs/kamikaze_komodo.log
RunMode = backtest

[API]
ExchangeID = krakenfutures
KrakenTestnet = True

[DataFetching]
DefaultSymbol = PF_XBTUSD
DefaultTimeframe = 4h
# Increased for more training data
HistoricalDataDays = 730Â 
DataFetchLimitPerCall = 500

[Trading]
MaxPortfolioRisk = 0.02
DefaultLeverage = 1.0
CommissionBPS = 10
SlippageBPS = 2
FundingRateAnnualized = 0.00

# Phase 7: Portfolio Configuration
[Portfolio]
TradingUniverse = PF_XBTUSD, PF_ETHUSD
# Activate a mix of strategies, including the new funding rate and ML strategies
ActiveStrategies = EWMAC_Strategy, FundingRateArb_Strategy, MLForecaster_Strategy
AssetAllocator = HRPAllocator
Rebalancer = BasicRebalancer
# --- Phase 7: Regime Filter ---
EnableRegimeFilter = True

[Backtesting]
InitialCapital = 10000.0

[EWMAC_Strategy]
ShortWindow = 12
LongWindow = 26
SignalWindow = 9
atr_period = 14
SentimentFilter_Long_Threshold = 0.05
SentimentFilter_Short_Threshold = -0.05
EnableShorting = True
# --- Phase 7: Regime Filter ---
UseRegimeFilter = True
# Defines which cluster IDs from the KMeans model are considered "trending" and thus favorable for this strategy.
# This requires manual analysis of the trained KMeans model's cluster centers.
# Assuming cluster '1' is the high-volatility, trending regime.
FavorableRegimes = 1

# --- NEW: Funding Rate Arbitrage Strategy ---
[FundingRateArb_Strategy]
# Enter a short if funding rate is > 0.01% (per period, not annualized)
entry_threshold = 0.0001
# Exit if funding rate drops below 0.005%
exit_threshold = 0.00005
EnableShorting = True

[RiskManagement]
StopManager_Default = TripleBarrier
# --- Position Sizer Params ---
PositionSizer = MLConfidencePositionSizer
# Base allocation is 10% of portfolio
MLConfidence_Base_Fraction = 0.10
MLConfidence_Min_Alloc_Fraction = 0.02
MLConfidence_Max_Alloc_Fraction = 0.25
# --- Stop Manager Params (for Triple Barrier) ---
TripleBarrier_TP_Multiple = 1.5
TripleBarrier_SL_Multiple = 1.0
TripleBarrier_Time_Limit_Bars = 15
ATRStop_ATRMultiple = 2.0


[PortfolioConstructor]
AssetAllocator = HRPAllocator # Ensure this is set
Rebalancer_DeviationThreshold = 0.05

[Rebalancer]
Rebalancer_DeviationThreshold = 0.02
Rebalancer_Min_Order_Value_USD = 10.0

[AI_NewsAnalysis]
EnableSentimentAnalysis = True
SimulatedSentimentDataPath = kamikaze_komodo/data/simulated_sentiment_data.csv
# Other params unchanged...

[VertexAI]
# Unchanged...
ProjectID = kamikazekomodo
Location = us-central1

# --- UPDATED: MLForecaster_Strategy now points to meta-labeling config ---
[MLForecaster_Strategy]
# This section now controls the live strategy's behavior
# Enter long if meta model confidence > 55%
longconfidencethreshold = 0.55
# Enter short if meta model confidence > 55%
shortconfidencethreshold = 0.55
atr_period = 14
EnableShorting = True

# FIX: Re-add the missing section for performance analysis
[BacktestingPerformance]
RiskFreeRateAnnual = 0.02
AnnualizationFactor = 252

# --- This section is for the K-Means model itself ---
[KMeans_Regime_Model]
Num_Clusters = 3
# Features should be calculated by the model. These names guide which features to create.
FeaturesForClustering = volatility_20d, atr_14d_percentage
TrainingDaysHistory = 1095
ModelSavePath = ml_models/trained_models
ModelFileName = kmeans_regime_PF_XBTUSD_4h.joblib